<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Java Dependency Graph Analyzer</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div id="app">
        <header>
            <h1>Java Dependency Graph Analyzer</h1>
            <div id="stats">
                <span id="node-count">Nodes: 0</span>
                <span id="edge-count">Edges: 0</span>
                <span id="connection-status" class="disconnected">Disconnected</span>
            </div>
        </header>

        <div id="controls">
            <div class="control-group">
                <h3>View Controls</h3>
                <button id="reset-camera">Reset Camera</button>
                <button id="toggle-labels">Toggle Labels</button>
                <button id="toggle-debug">Toggle Debug View</button>
            </div>
            <div class="control-group">
                <h3>Info</h3>
                <div id="hover-info">Hover over a node to see details</div>
                <div id="selected-info"></div>
            </div>
        </div>

        <!-- Debug panel to show edges list -->
        <div id="debug-panel" style="position:absolute;top:80px;right:20px;width:400px;max-height:70vh;overflow-y:auto;background:rgba(0,0,0,0.9);padding:15px;border-radius:10px;z-index:100;font-family:monospace;font-size:12px;">
            <h3 style="color:#4488ff;margin-bottom:10px;">Edge List (Debug)</h3>
            <div id="edge-count-debug" style="color:#88ff88;margin-bottom:10px;"></div>
            <div id="edge-list" style="color:#fff;"></div>
        </div>

        <div id="canvas-container">
            <canvas id="graph-canvas"></canvas>
        </div>

        <div id="loading">
            <div class="spinner"></div>
            <p>Connecting to server...</p>
        </div>
    </div>

    <!-- Three.js library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <!-- OrbitControls for Three.js r128 -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <script>
        // Ensure OrbitControls is properly attached to THREE namespace
        // This runs after both scripts have loaded
        (function() {
            function setupOrbitControls() {
                if (typeof THREE === 'undefined') {
                    console.warn('THREE.js not loaded');
                    return;
                }
                
                // Check various ways OrbitControls might be available
                if (typeof OrbitControls !== 'undefined') {
                    THREE.OrbitControls = OrbitControls;
                    console.log('OrbitControls attached to THREE namespace');
                } else if (typeof THREE.OrbitControls !== 'undefined') {
                    console.log('OrbitControls already on THREE namespace');
                } else {
                    console.error('OrbitControls setup failed - THREE:', typeof THREE, 'OrbitControls:', typeof OrbitControls);
                    console.error('This may cause camera controls to not work');
                }
            }
            
            // Try multiple times to handle async loading
            setupOrbitControls();
            setTimeout(setupOrbitControls, 50);
            setTimeout(setupOrbitControls, 200);
            window.addEventListener('load', setupOrbitControls);
        })();
    </script>

    <!-- Application scripts -->
    <script src="js/websocket-client.js"></script>
    <script src="js/graph-visualizer.js"></script>
    <script src="js/main.js"></script>
</body>
</html>
